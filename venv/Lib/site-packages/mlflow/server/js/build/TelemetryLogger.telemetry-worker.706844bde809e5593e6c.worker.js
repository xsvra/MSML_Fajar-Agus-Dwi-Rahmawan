!function(){"use strict";let e=function(e){return e.READY="READY",e}({}),t=function(e){return e.LOG_EVENT="LOG_EVENT",e.SHUTDOWN="SHUTDOWN",e}({});const s="../ajax-api/3.0/mlflow/ui-telemetry";class o{constructor(){this.queue=[],this.flushTimer=null,this.startFlushTimer()}enqueue(e){null!==this.flushTimer&&this.queue.push(e)}startFlushTimer(){null===this.flushTimer&&this.scheduleNextFlush()}scheduleNextFlush(){this.flushTimer=self.setTimeout((()=>{this.flush(),this.scheduleNextFlush()}),3e4)}stopFlushTimer(){null!==this.flushTimer&&(self.clearTimeout(this.flushTimer),this.flushTimer=null),this.flush()}async flush(){if(0===this.queue.length||!navigator.onLine)return;const e=[...this.queue];this.queue=[];try{const t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({records:e})});if(!t.ok)return console.error(`[LogQueue] Failed to upload batch: ${t.status}`),void this.queue.unshift(...e);"disabled"===(await t.json()).status&&this.destroy()}catch(t){console.error("[LogQueue] Error uploading batch:",t),this.queue.unshift(...e)}}clear(){this.queue=[]}destroy(){this.stopFlushTimer(),this.queue=[]}}const i=self;const u=new class{constructor(){this.config=async function(){try{const e=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to fetch config: ${e.status}`);return await e.json()}catch(e){return console.error("[TelemetryWorker] Failed to fetch config:",e),null}}(),this.sessionId=crypto.randomUUID(),this.logQueue=new o,this.samplingValue=100*Math.random()}async addLogToQueue(e){var t,s,o,i,u;const n=await this.config;if(!n||null===(t=n.disable_ui_telemetry)||void 0===t||t)return;if(!(this.samplingValue<(null!==(s=n.ui_rollout_percentage)&&void 0!==s?s:0)))return;(null===(o=n.disable_ui_events)||void 0===o?void 0:o.includes(null!==(i=null===(u=e.params)||void 0===u?void 0:u.componentId)&&void 0!==i?i:""))||this.logQueue.enqueue({...e,session_id:this.sessionId})}destroy(){this.logQueue.destroy()}};function n(e){const s=e.data;switch(s.type){case t.LOG_EVENT:u.addLogToQueue(s.payload).catch((e=>{console.error("[TelemetryWorker] Error logging event:",e)}));break;case t.SHUTDOWN:u.destroy(),i.close()}}i.onconnect=t=>{const s=t.ports[0];s.onmessage=n,s.postMessage({type:e.READY})}}();